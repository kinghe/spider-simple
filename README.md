#spider-simple

简易的网络爬虫系统

#系统设计思路(System Design)
爬虫系统应该包括如下部分
##任务管理模块task module。

用户和系统交互的中转部分,主要包括UI用户交互模块和任务执行模块。
任务主要包括4个状态`status`。
* `TODO` 由用户新建时预定义，主要用于任务后的状态识别。任务可以立即执行或者定时执行。
* `DOING` 任务开始启动时由任务模块变更任务状态。
* `DONE` 任务完成状态标志。由任务模块在所有任务结束后，负责变更到此任务状态，同时更新任务统计信息`statistics`。
* `UNDO` 任务取消，由用户手工确认后系统变更此标示，注意：
	* 1.任务处于UNDO/DONE时不可变更到此标示,即不可对以及取消或者以及完成的任务进行取消，操作无意义。
	* 2.任务处于`TODO`状态时，直接变更状态即可，无需通知任务执行模块。
	* 3.任务处于`DOING`状态时，不可直接变更状态需通知任务执行系统停止此任务的所有执行后，由任务执行系统变更到此状态，并同时统计任务已执行情况。

###任务运行模块`Task Run Module`
任务运行模块的运行依赖于任务模板信息，见`template@task`。
任务模板信息主要包括
* 子任务并行策略。子任务主要包括资源下载任务`resource down` 和数据分析任务`data parse`。一个用户task由多个子任务构成。子任务之间存在执行依赖，并发控制，分布式调度等，安排子任务执行策略相当的重要。
* 下载会话策略。大部分系统需要经过身份验证后方可获取真正的资源。现运行的主要是经过特殊的子任务(请求登陆页面)获取所需的cookie。
* 资源分组策略。见`group@down`。待下载资源建立时先行建立文件分类索引，
	* `数据分析类` 主要包括`网页HTML`,`XML`。定义为数据分析类的资源用于建立相关联的`数据分析`子任务。
	* `多媒体multi-media` 主要包括图片类jpg/png/gif,视频类mp3/flv/mp4,文档类doc/xls/pdf
	* `其他other` 符合下载策略的资源，但不做任何处理。
* 数据分析策略。主要完成数据的筛选，以进一步的处理。语句见`策略模块`。数据分析工作主要包括二个部分。
	* 资源爬取策略。筛选指定元素，从中获取新的资源url，资源描述，新建下载任务(存储于`down`表)，并调度下载模块完成资源下载。
	* 数据分组策略。筛选指定元素，从中获取有用数据(字符串或者格式化数据)，存储于`data`表(见`数据分析`->`数据模型定义`)，同时提取关键字为本组数据划分标签。
	* 通知策略。主要用于重要信息对用户的通知。筛选指定元素，从中获取有用数据通知用户。详见`系统模块`的`通知模块Notify Module`。

###数据模型定义
* `task` :爬虫任务/spider task。
	* |--`id`:pk
	* |--``status``:任务状态.新建待运行TODO，运行中DOING，完成DONE，任务取消UNDO.
	* |--`url`:资源入口。用于获取的第一个资源
	* |--`depth`:资源爬取深度.
	* |--`start`:任务启动时间(用于定时启动).
	* |--``template``:任务使用的爬虫规则模板(资源爬虫策略，数据分析挖掘，通知系统email或者sms等)
	* |--`description`:任务描述
	* |--`statistics:执行结果(成功success，部分成功?half-success，失败failture)，爬取资源统计(总数,成功，失败)，耗时统计(总耗时，成功资源平均下载速度，失败资源耗时)，最优/差下载速度资源列举

##资源下载模块down module。

###系统信息
* 所属任务`task@down`
* 上一级资源`parent@down`
* 资源深度`depth@down`
* 本地或者局域网存储信息`store@down` 
* 执行下载的爬虫标示`spider@down` 下载任务执行时由执行的爬虫自行标示
* 下载任务状态`status@down`

###下载请求信息
* 资源远程路径`url@down`.
* 用户请求类型`method@down`为空时默认get方法
* 用户认证信息`cookie@down`

###下载统计信息
* 下载开始时间`start@down`
* 时间消耗`spend@down`
* 资源大小`size@down`

###资源信息
* 资源分组`group@down`
* 资源描述标签`tag@down`
* 文本文件字符集`charset@down`
* 资源描述`description@down`


###数据模型定义
* `down`:资源下载信息/resource down info。
	* |--`id`:pk
	* |--`task`:任务号，
	* |--`parent`:来源资源，对于初始化资源此项为空。其他资源为来源资源的父id
	* |--`depth`:爬虫深度，
	* |--`store`:本地存储
	* |--`spider`:执行爬虫(用于分布式系统)，同时也用于指定本地网络存储信息的位置
	* |--`status`:资源状态(通`status@task`)
	* |--`url`:资源路径
	* |--`method`:资源请求类型。默认get
	* |--`cookie`:资源cookie
	* |--`start`:开始时间，
	* |--`spend`:下载所需时间(ms)
	* |--`size`:资源大小。(Byte)
	* |--`group`:资源类型。
	* |--`tag`:资源描述标签，用于索引查询，资源分组
	* |--`charset`:资源字符集。
	* |--`description`:资源描述

##数据分析模块/data parse module。
当数据分析类的资源下载完成后随即启动数据分析子任务。
###待分析资源
* `HTML文档`。爬虫系统的主分析资源，系统将根据`HTML文档`解析为`DOM树`,使用`CSS`的方式分析指定的元素，筛选相关元素用于以下处理。
	* 新待下载资源。新建下一深度的资源列表，并保持至`down`表。
	* 数据汇总/统计。为数据挖掘部分，挑选出用户需要的信息并存储至`data`表。
	* 智能机器人，后续扩展此功能。在挖掘出有用信息后，系统提供的自动处理系统，具有简单智慧，自主学习功能，
* `XML文档`。如`RSS`，`WebService`等服务。处理类似于 `HTML文档`
* `多媒体`。包括
	* 图片。如图片格式，长宽i*i,关键位置像素记录等可以直接存储于标签中。后续深入图形学研究后进一步挖掘有用信息。
	* 文档。
	* 视频，声音文件。

###数据模型定义
* `data`:记录每个资源(url)分析信息
	* |--down:pk.资源ID
	* |--task:任务号，
	* |--file:数据存储文件位置，主要用于大数据量信息存储
	* |--info:数据存储信息，主要用于小数据量信息存储
	* |--tag:资源描述标签

##策略模块/strategy module。
TODO
根据资源类型，名称选择相关的数据解析模块。若无法找到资源解析器，不予解析.其中，HTML解析为核心模块。规则管理模块主要也是针对的html的解析。<br>

* 规则定义(syntax)。
	* 基础语法结构B:`选择器selectors`{`标签处理tag handle`}。采用css语法获取待分析元素。
		* 选择器selector.采用CSS2语法。
		* 标签处理tag handle。与css2相异。CSS2是对符合选择器的所有元素属性值的统一设置，而本规则是对符合选择器的所有元素属性值的迭代处理。
			* down url.新下载资源`url`。
			* select data into gbl_list。将数据append指定的全局资源列表`gbl_list`中。其中`gbl_list`为数组，data为字符串string，数组list，或者字典map。当data为list|map时,常用于单个资源，或整个task完成后的统计分析工作
			* group gbl_list [by index/key].为`gbl_list`分组
			* template template_name.引用规则模板完成数据处理。
	* 复合语法结构C。`选择器selectors`[(B|C)+]
* 规则模板(template)。对常用的规则完成模板化。

##系统模块System Module
系统通用模块
###用户默认设置User Default Config

###定时触发Timer

###通知模块Notify Module
通知包括email，sms，app等。

###用户场景模式
为适应多种用户，提供多种场景操作模式`scene`。
* `最简操作模式`。界面设计要求便捷，易操作。用户仅需提供一个url人口即可，资源爬取策略和数据分析挖掘模块由开发人员按照用户要求设计开发定制，以默认模板的方式提供。
* `定制操作模式`。提供自定义模板管理功能。对用户要求较高，用于更加精细化的任务定制,包括资源爬取策略和数据分析挖掘策略的自定义。

##后续扩展

###智能机器人Intelligent Robot
作为数据分析的一个子部分
